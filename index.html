<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Merry Christmas ðŸŽ„</title>
<style>
html,body{
  margin:0; padding:0; overflow:hidden;
  background:#000; color:#fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}
canvas{ display:block; touch-action:none; }

#photoPreview{
  position:fixed; inset:0;
  background:rgba(0,0,0,.85);
  display:none; align-items:center; justify-content:center;
  z-index:10;
}
#photoPreview img{
  max-width:90vw; max-height:90vh;
  border-radius:12px;
}
#photoPreview span{
  position:absolute; top:20px; right:24px;
  font-size:28px; cursor:pointer;
}
</style>
</head>
<body>

<div id="photoPreview">
  <span onclick="closePreview()">âœ•</span>
  <img id="previewImg"/>
</div>

<script type="module">
import * as THREE from "https://esm.sh/three@0.159.0";

const params = new URLSearchParams(location.search);
const isShare = params.has("share");

const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000, 6, 18);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0,2.5,8);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1.2);
light.position.set(5,10,5);
scene.add(light, new THREE.AmbientLight(0xffffff,.6));

// ðŸŽ„ Tree
const tree = new THREE.Group();
scene.add(tree);

const coneMat = new THREE.MeshStandardMaterial({color:0x0b6b3a});
for(let i=0;i<5;i++){
  const geo = new THREE.ConeGeometry(2.4-i*0.4,2.2,24);
  const mesh = new THREE.Mesh(geo, coneMat);
  mesh.position.y = i*0.9;
  tree.add(mesh);
}

// â­ Star
const star = new THREE.Mesh(
  new THREE.IcosahedronGeometry(0.3),
  new THREE.MeshStandardMaterial({color:0xffd700, emissive:0xffaa00})
);
star.position.y = 4.8;
tree.add(star);

// â„ï¸ Particles
const snowGeo = new THREE.BufferGeometry();
const snowCount = 500;
const pos = new Float32Array(snowCount*3);
for(let i=0;i<snowCount;i++){
  pos[i*3] = (Math.random()-0.5)*20;
  pos[i*3+1] = Math.random()*12;
  pos[i*3+2] = (Math.random()-0.5)*20;
}
snowGeo.setAttribute("position", new THREE.BufferAttribute(pos,3));
const snow = new THREE.Points(
  snowGeo,
  new THREE.PointsMaterial({color:0xffffff, size:0.06})
);
scene.add(snow);

// ðŸ–¼ Photos
const photoGroup = new THREE.Group();
tree.add(photoGroup);

const photos = [
  "assets/photos/01.jpg",
  "assets/photos/02.jpg",
  "assets/photos/03.jpg",
  "assets/photos/04.jpg",
  "assets/photos/05.jpg",
  "assets/photos/06.jpg",
  "assets/photos/07.jpg",
  "assets/photos/08.jpg",
  "assets/photos/09.jpg"
];

const loader = new THREE.TextureLoader();
photos.forEach((url,i)=>{
  loader.load(url, tex=>{
    const mat = new THREE.MeshBasicMaterial({map:tex});
    const mesh = new THREE.Mesh(new THREE.PlaneGeometry(0.9,0.9), mat);
    const a = i/photos.length * Math.PI*2;
    mesh.position.set(Math.cos(a)*1.5, 1 + Math.random()*2.5, Math.sin(a)*1.5);
    mesh.lookAt(0,mesh.position.y,0);
    mesh.userData.url = url;
    photoGroup.add(mesh);
  });
});

// ðŸ‘† Interaction
let dragging=false, lx=0;
renderer.domElement.addEventListener("pointerdown",e=>{
  dragging=true; lx=e.clientX;
});
window.addEventListener("pointerup",()=>dragging=false);
window.addEventListener("pointermove",e=>{
  if(dragging){
    tree.rotation.y += (e.clientX-lx)*0.005;
    lx=e.clientX;
  }
});

const ray = new THREE.Raycaster();
const mouse = new THREE.Vector2();
renderer.domElement.addEventListener("click",e=>{
  mouse.x = (e.clientX/innerWidth)*2-1;
  mouse.y = -(e.clientY/innerHeight)*2+1;
  ray.setFromCamera(mouse,camera);
  const hit = ray.intersectObjects(photoGroup.children);
  if(hit.length){
    showPreview(hit[0].object.userData.url);
  }
});

function showPreview(url){
  previewImg.src = url;
  photoPreview.style.display="flex";
}
window.closePreview = ()=>{
  photoPreview.style.display="none";
};

// ðŸŽž Animate
function animate(){
  requestAnimationFrame(animate);
  snow.rotation.y += 0.0008;
  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>

